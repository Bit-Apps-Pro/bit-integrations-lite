{"version":3,"file":"bi.758.736.js","sources":["../frontend-dev/src/components/AllIntegrations/TutorLms/TutorLmsCommonFunc.js","../frontend-dev/src/components/AllIntegrations/TutorLms/TutorLmsIntegLayout.jsx"],"sourcesContent":["import toast from 'react-hot-toast'\nimport { __ } from '../../../Utils/i18nwrap'\nimport bitsFetch from '../../../Utils/bitsFetch'\nimport { deepCopy } from '../../../Utils/Helpers'\n\nexport const handleInput = (e, tutorlmsConf, setTutorlmsConf, setIsLoading, setSnackbar) => {\n  let newConf = deepCopy(tutorlmsConf)\n  const { name, value } = e.target\n  newConf[name] = value\n\n  switch (name) {\n    case 'module':\n      newConf = moduleChange(newConf, setTutorlmsConf, setIsLoading, setSnackbar)\n      break\n    default:\n      break\n  }\n  setTutorlmsConf(newConf)\n}\n\nexport const moduleChange = (tutorlmsConf, setTutorlmsConf, setIsLoading, setSnackbar) => {\n  let newConf = deepCopy(tutorlmsConf)\n  newConf.field_map = []\n\n  if (!newConf?.default?.fields?.[tutorlmsConf.module]) {\n    refreshFields(newConf, setTutorlmsConf, setIsLoading, setSnackbar)\n  } else {\n    newConf = generateMappedFields(newConf)\n  }\n\n  return newConf\n}\n\nexport const getAllCourses = (tutorlmsConf, setTutorlmsConf, setIsLoading, value = null) => {\n  setIsLoading(true)\n  const queryParams = { type: value }\n  const loadPostTypes = bitsFetch(null, 'tutor_all_course', queryParams, 'GET')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...tutorlmsConf }\n        if (!newConf.default) newConf.default = {}\n        newConf.default.courses = result.data\n        setTutorlmsConf({ ...newConf })\n        setIsLoading(false)\n        return 'Courses fetched successfully'\n      }\n      setIsLoading(false)\n      return 'Courses fetch failed. please try again'\n    })\n  toast.promise(loadPostTypes, {\n    success: data => data,\n    error: __('Error Occurred', 'bit-integrations'),\n    loading: __('Loading Courses...'),\n  })\n}\n\nexport const getAllLesson = (tutorlmsConf, setTutorlmsConf, setIsLoading) => {\n  setIsLoading(true)\n  const loadPostTypes = bitsFetch(null, 'tutor_all_lesson', '', 'GET')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...tutorlmsConf }\n        if (!newConf.default) newConf.default = {}\n        newConf.default.lessons = result.data\n        setTutorlmsConf({ ...newConf })\n        setIsLoading(false)\n        return 'Lessons fetched successfully'\n      }\n      setIsLoading(false)\n      return 'Lessons fetch failed, please try again...'\n    })\n  toast.promise(loadPostTypes, {\n    success: data => data,\n    error: __('Error Occurred', 'bit-integrations'),\n    loading: __('Loading Lessons...'),\n  })\n}\n\nconst generateMappedFields = tutorlmsConf => {\n  const newConf = deepCopy(tutorlmsConf)\n  newConf.default.fields[newConf.module].required.forEach(reqFld => {\n    if (!newConf.field_map.find(fld => fld.wcField === reqFld)) {\n      newConf.field_map.unshift({ formField: '', wcField: reqFld, required: true })\n    }\n  })\n  if (!newConf.field_map.length) newConf.field_map = [{ formField: '', wcField: '' }]\n  return newConf\n}\n","/* eslint-disable no-unused-expressions */\nimport MultiSelect from 'react-multiple-select-dropdown-lite'\nimport { __ } from '../../../Utils/i18nwrap'\nimport Loader from '../../Loaders/Loader'\nimport { getAllCourses, getAllLesson } from './TutorLmsCommonFunc'\nimport Note from '../../Utilities/Note'\n\nexport default function TutorLmsIntegLayout({ tutorlmsConf, setTutorlmsConf, isLoading, setIsLoading }) {\n  const action = [\n    { value: 'enroll-course', label: 'Enroll the user in a course' },\n    { value: 'unenroll-course', label: 'Unenroll user from a course' },\n    { value: 'complete-course', label: 'Mark a course complete for the user' },\n    { value: 'complete-lesson', label: 'Mark a lesson complete for the user' },\n    { value: 'reset-course', label: 'Reset the user progress in a course' },\n  ]\n\n  const handleAction = (e) => {\n    const newConf = { ...tutorlmsConf }\n    const { name, value } = e.target\n    if (e.target.value !== '') {\n      newConf[name] = value\n    } else {\n      delete newConf[name]\n    }\n    if (name === 'actionName') {\n      if (newConf?.selectedCourse) delete newConf.selectedCourse\n      if (newConf?.selectedLesson) delete newConf.selectedLesson\n      if (newConf?.selectedAllCourse) delete newConf.selectedAllCourse\n      setTutorlmsConf({ ...newConf })\n\n      if (value === 'enroll-course' || value === 'unenroll-course' || value === 'complete-course' || value === 'reset-course') {\n        getAllCourses(newConf, setTutorlmsConf, setIsLoading, value)\n      } else if (value === 'complete-lesson') {\n        getAllLesson(newConf, setTutorlmsConf, setIsLoading)\n      }\n    } else {\n      setTutorlmsConf({ ...newConf })\n    }\n  }\n\n  const setChanges = (val, type) => {\n    const newConf = { ...tutorlmsConf }\n    if (val) {\n      if (type === 'selectedCourse' && val.includes('all-course')) {\n        newConf.selectedAllCourse = newConf.default.courses\n      }\n      newConf[type] = val ? val.split(',') : []\n    } else {\n      newConf?.selectedAllCourse && delete newConf.selectedAllCourse\n    }\n    setTutorlmsConf({ ...newConf })\n  }\n\n  return (\n    <>\n      <br />\n      <div className=\"flx\">\n        <b className=\"wdt-200 d-in-b\">{__('Action:', 'bit-integrations')}</b>\n        <select onChange={handleAction} name=\"actionName\" value={tutorlmsConf?.actionName} className=\"btcd-paper-inp w-5\">\n          <option value=\"\">{__('Select Action', 'bit-integrations')}</option>\n          {\n            action.map(({ label, value }) => (\n              <option key={label} value={value}>\n                {label}\n              </option>\n            ))\n          }\n        </select>\n      </div>\n      <br />\n\n      {\n        (tutorlmsConf?.actionName === 'enroll-course' || tutorlmsConf?.actionName === 'unenroll-course' || tutorlmsConf?.actionName === 'complete-course' || tutorlmsConf?.actionName === 'reset-course')\n        && (\n\n          <div className=\"flx\">\n            <b className=\"wdt-200 d-in-b\">{__('Select Course: ', 'bit-integrations')}</b>\n            <MultiSelect\n              defaultValue={tutorlmsConf?.selectedCourse}\n              className=\"btcd-paper-drpdwn w-5\"\n              options={tutorlmsConf?.default?.courses && tutorlmsConf.default.courses.map(course => ({ label: course.courseTitle, value: course.courseId.toString() }))}\n              onChange={val => setChanges(val, 'selectedCourse')}\n              singleSelect={tutorlmsConf?.actionName === 'complete-course' || tutorlmsConf?.actionName === 'reset-course'}\n            />\n            <button onClick={() => getAllCourses(tutorlmsConf, setTutorlmsConf, setIsLoading, tutorlmsConf?.actionName)} className=\"icn-btn sh-sm ml-2 mr-2 tooltip\" style={{ '--tooltip-txt': `${__('Refresh Courses', 'bit-integrations')}'` }} type=\"button\" disabled={isLoading}>&#x21BB;</button>\n\n          </div>\n\n        )\n      }\n      {\n        (tutorlmsConf?.actionName === 'complete-lesson')\n        && (\n\n          <div className=\"flx\">\n            <b className=\"wdt-200 d-in-b\">{__('Select Lessons: ', 'bit-integrations')}</b>\n            <MultiSelect\n              defaultValue={tutorlmsConf?.selectedLesson}\n              className=\"btcd-paper-drpdwn w-5\"\n              options={tutorlmsConf?.default?.lessons && tutorlmsConf.default.lessons.map(lesson => ({ label: lesson.lessonTitle, value: lesson.lessonId.toString() }))}\n              onChange={val => setChanges(val, 'selectedLesson')}\n              singleSelect\n            />\n            <button onClick={() => getAllLesson(tutorlmsConf, setTutorlmsConf, setIsLoading)} className=\"icn-btn sh-sm ml-2 mr-2 tooltip\" style={{ '--tooltip-txt': `${__('Refresh Courses', 'bit-integrations')}'` }} type=\"button\" disabled={isLoading}>&#x21BB;</button>\n\n          </div>\n\n        )\n      }\n\n      <br />\n      <br />\n      {\n        isLoading && (\n          <Loader style={{\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            height: 100,\n            transform: 'scale(0.7)',\n          }}\n          />\n        )\n      }\n      <Note\n        note=\"This integration will only work for logged-in users.\"\n      />\n    </>\n  )\n}\n"],"names":["jsxRuntimeExports","Loader","deepCopy","bitsFetch","_t","__","u","Note","handleInput","tutorlmsConf","setTutorlmsConf","setIsLoading","setSnackbar","newConf","name","value","moduleChange","_a","_b","generateMappedFields","getAllCourses","loadPostTypes","result","__spreadValues","toast","data","getAllLesson","reqFld","fld","TutorLmsIntegLayout","isLoading","action","handleAction","e","setChanges","val","type","jsxs","Fragment","jsx","label","MultiSelect","course","lesson"],"mappings":"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"}