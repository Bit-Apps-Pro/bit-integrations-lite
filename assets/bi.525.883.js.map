{"version":3,"file":"bi.525.883.js","sources":["../frontend-dev/src/components/AllIntegrations/LionDesk/LionDeskCommonFunc.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable no-else-return */\nimport toast from 'react-hot-toast'\nimport bitsFetch from '../../../Utils/bitsFetch'\nimport { __ } from '../../../Utils/i18nwrap'\n\nexport const handleInput = (e, lionDeskConf, setLionDeskConf) => {\n  const newConf = { ...lionDeskConf }\n  const { name } = e.target\n  if (e.target.value !== '') {\n    newConf[name] = e.target.value\n  } else {\n    delete newConf[name]\n  }\n  setLionDeskConf({ ...newConf })\n}\n\nexport const generateMappedField = (lionDeskConf) => {\n  let allFields = []\n  if (lionDeskConf.actionName === 'campaign') {\n    allFields = lionDeskConf?.campaignFields\n  } else if (lionDeskConf.actionName === 'contact') {\n    allFields = lionDeskConf?.contactFields\n  }\n  const requiredFlds = allFields && allFields.filter(\n    (fld) => fld.required === true,\n  )\n  return requiredFlds.length > 0\n    ? requiredFlds.map((field) => ({\n      formField: '',\n      lionDeskFormField: field.key,\n    }))\n    : [{ formField: '', lionDeskFormField: '' }]\n}\n\nexport const checkMappedFields = (lionDeskConf) => {\n  const mappedFields = lionDeskConf?.field_map\n    ? lionDeskConf.field_map.filter(\n      (mappedField) => !mappedField.formField\n        || !mappedField.lionDeskFormField\n        || (mappedField.formField === 'custom' && !mappedField.customValue)\n        || (mappedField.lionDeskFormField === 'customFieldKey'\n          && !mappedField.customFieldKey),\n    )\n    : []\n  if (mappedFields.length > 0) {\n    return false\n  }\n  return true\n}\n\nexport const setGrantTokenResponse = (integ) => {\n  const grantTokenResponse = {}\n  const authWindowLocation = window.location.href\n  const queryParams = authWindowLocation.replace(`${window.opener.location.href}/redirect`, '').split('&')\n  if (queryParams) {\n    queryParams.forEach(element => {\n      const gtKeyValue = element.split('=')\n      if (gtKeyValue[1]) {\n        // eslint-disable-next-line prefer-destructuring\n        grantTokenResponse[gtKeyValue[0]] = gtKeyValue[1]\n      }\n    })\n  }\n  localStorage.setItem(`__${integ}`, JSON.stringify(grantTokenResponse))\n  window.close()\n}\n\nexport const handleAuthorize = (integ, ajaxInteg, confTmp, setConf, setError, setisAuthorized, setIsLoading, setSnackbar, btcbi) => {\n  if (!confTmp.clientId || !confTmp.clientSecret) {\n    setError({\n      clientId: !confTmp.clientId ? __('Client ID cann\\'t be empty', 'bit-integrations') : '',\n      clientSecret: !confTmp.clientSecret ? __('Secret key cann\\'t be empty', 'bit-integrations') : '',\n    })\n    return\n  }\n\n  setIsLoading(true)\n  const apiEndpoint = `https://api-v2.liondesk.com/oauth2/authorize?response_type=code&client_id=${confTmp.clientId}&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(`${btcbi.api.base}`)}/redirect&scope=['write','read']`\n  const authWindow = window.open(apiEndpoint, integ, 'width=400,height=609,toolbar=off')\n  const popupURLCheckTimer = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(popupURLCheckTimer)\n      let grantTokenResponse = {}\n      let isauthRedirectLocation = false\n      const bitintegrationLionDesk = localStorage.getItem(`__${integ}`)\n\n      if (bitintegrationLionDesk) {\n        isauthRedirectLocation = true\n        grantTokenResponse = JSON.parse(bitintegrationLionDesk)\n        localStorage.removeItem(`__${integ}`)\n      }\n      if (!grantTokenResponse.code || grantTokenResponse.error || !grantTokenResponse || !isauthRedirectLocation) {\n        const errorCause = grantTokenResponse.error ? `Cause: ${grantTokenResponse.error}` : ''\n        setSnackbar({ show: true, msg: `${__('Authorization failed', 'bit-integrations')} ${errorCause}. ${__('please try again', 'bit-integrations')}` })\n        setIsLoading(false)\n      } else {\n        const newConf = { ...confTmp }\n        newConf.accountServer = grantTokenResponse['accounts-server']\n        tokenHelper(ajaxInteg, grantTokenResponse, newConf, setConf, setisAuthorized, setIsLoading, setSnackbar, btcbi)\n      }\n    }\n  }, 500)\n}\n\nconst tokenHelper = (ajaxInteg, grantToken, confTmp, setConf, setisAuthorized, setIsLoading, setSnackbar, btcbi) => {\n  const tokenRequestParams = { ...grantToken }\n  tokenRequestParams.clientId = confTmp.clientId\n  tokenRequestParams.clientSecret = confTmp.clientSecret\n  tokenRequestParams.redirectURI = `${btcbi.api.base}/redirect`\n\n  bitsFetch(tokenRequestParams, `${ajaxInteg}_generate_token`)\n    .then(result => result)\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...confTmp }\n        newConf.tokenDetails = result.data\n        setConf(newConf)\n        setisAuthorized(true)\n        setSnackbar({ show: true, msg: __('Authorized Successfully', 'bit-integrations') })\n      } else if ((result && result.data && result.data.data) || (!result.success && typeof result.data === 'string')) {\n        setSnackbar({ show: true, msg: `${__('Authorization failed Cause:', 'bit-integrations')}${result.data.data || result.data}. ${__('please try again', 'bit-integrations')}` })\n      } else {\n        setSnackbar({ show: true, msg: __('Authorization failed. please try again', 'bit-integrations') })\n      }\n      setIsLoading(false)\n    })\n}\n\nexport const getCustomFields = (confTmp, setConf, setIsLoading, btcbi) => {\n  setIsLoading(true)\n  const requestParams = {\n    token_details: confTmp.tokenDetails,\n    client_id: confTmp.clientId,\n    client_secret: confTmp.clientSecret,\n    redirect_uri: `${btcbi.api.base}/redirect`,\n  }\n\n  bitsFetch(requestParams, 'lionDesk_fetch_custom_fields').then((result) => {\n    if (result && result.success) {\n      setIsLoading(false)\n      if (result.data) {\n        setConf(prevConf => {\n          const newConf = { ...prevConf }\n          newConf.customFields = result.data\n          return newConf\n        })\n        toast.success(\n          __('Custom fields also fetched successfully', 'bit-integrations'),\n        )\n      } else {\n        toast.error(__('No custom fields found', 'bit-integrations'))\n      }\n      return\n    }\n    setIsLoading(false)\n    toast.error(__(`Custom fields fetching failed ${result.data}`, 'bit-integrations'))\n  })\n}\n\nexport const getAllTags = (confTmp, setConf, setLoading) => {\n  setLoading({ ...setLoading, tags: true })\n  const requestParams = {\n    token_details: confTmp.tokenDetails,\n    client_id: confTmp.clientId,\n    client_secret: confTmp.clientSecret,\n    redirect_uri: confTmp.redirectURI,\n  }\n\n  bitsFetch(requestParams, 'lionDesk_fetch_all_tags').then(\n    (result) => {\n      if (result && result.success) {\n        setLoading({ ...setLoading, tags: false })\n        if (result.data) {\n          setConf(prevConf => {\n            const newConf = { ...prevConf }\n            newConf.tags = result.data\n            return newConf\n          })\n          toast.success(\n            __('Tags fetched successfully', 'bit-integrations'),\n          )\n        } else {\n          toast.error(__('No Tags found', 'bit-integrations'))\n        }\n        return\n      }\n      setLoading({ ...setLoading, tags: false })\n      toast.error(\n        __(`Tags fetching failed ${result.data}`, 'bit-integrations'),\n      )\n    },\n  )\n}"],"names":["__","bitsFetch","_t","handleInput","e","lionDeskConf","setLionDeskConf","newConf","__spreadValues","name","generateMappedField","allFields","requiredFlds","fld","field","checkMappedFields","mappedField","setGrantTokenResponse","integ","grantTokenResponse","queryParams","element","gtKeyValue","handleAuthorize","ajaxInteg","confTmp","setConf","setError","setisAuthorized","setIsLoading","setSnackbar","btcbi","apiEndpoint","authWindow","popupURLCheckTimer","isauthRedirectLocation","bitintegrationLionDesk","errorCause","tokenHelper","grantToken","tokenRequestParams","result","getCustomFields","requestParams","prevConf","toast","getAllTags","setLoading","__spreadProps"],"mappings":"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"}