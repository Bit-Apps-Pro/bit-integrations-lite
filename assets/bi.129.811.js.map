{"version":3,"file":"bi.129.811.js","sources":["../frontend-dev/src/components/AllIntegrations/Mailercloud/MailercloudCommonFunc.js"],"sourcesContent":["/* eslint-disable no-unused-expressions */\nimport toast from \"react-hot-toast\";\nimport bitsFetch from \"../../../Utils/bitsFetch\";\nimport { __ } from \"../../../Utils/i18nwrap\";\nimport {\n  saveIntegConfig,\n  saveActionConf,\n} from \"../IntegrationHelpers/IntegrationHelpers\";\n\nexport const handleInput = (e, conf, setConf, error, setError) => {\n  const newConf = { ...conf };\n  const inputError = { ...error };\n  inputError[e.target.name] = \"\";\n  newConf[e.target.name] = e.target.value;\n  setError(inputError);\n  setConf(newConf);\n};\n\nexport const handleAuthorize = (\n  conf,\n  setError,\n  setAuthorized,\n  loading,\n  setLoading\n) => {\n  if (!conf.authKey) {\n    setError({ authKey: !conf.authKey ? __(\"API key can't be empty\") : \"\" });\n    return;\n  }\n  setError({});\n  setLoading({ ...loading, auth: true });\n\n  const requestParams = { authKey: conf.authKey };\n\n  bitsFetch(requestParams, \"mailercloud_handle_authorize\").then((result) => {\n    if (!result.data.errors) {\n      setAuthorized(true);\n      setLoading({ ...loading, auth: false });\n      toast.success(__(\"Authorized successfully\"));\n      return;\n    }\n    setLoading({ ...loading, auth: false });\n    toast.error(__(\"Authorized failed\"));\n  });\n};\n\nexport const getAllLists = async (conf, setConf, loading, setLoading) => {\n  setLoading && setLoading({ ...loading, list: true });\n  const requestParams = { authKey: conf.authKey };\n  const result = await bitsFetch(requestParams, \"mailercloud_get_all_lists\");\n  if (result.success) {\n    const { data } = result.data;\n    const newConf = { ...conf };\n    if (data) {\n      if (!newConf.default) {\n        newConf.default = {};\n      }\n      newConf.default.lists = data;\n      setConf(newConf);\n      if (setLoading) {\n        setLoading({ ...loading, list: false });\n        toast.success(__(\"Tag refresh successfully\"));\n      }\n    }\n    return true;\n  }\n  if (setLoading) {\n    setLoading({ ...loading, list: false });\n    toast.success(__(\"Tag refresh failed\"));\n  }\n  return false;\n};\n\nexport const getAllFields = async (conf, setConf, loading, setLoading) => {\n  setLoading && setLoading({ ...loading, field: true });\n  const requestParams = { authKey: conf.authKey };\n  const result = await bitsFetch(requestParams, \"mailercloud_get_all_fields\");\n  if (result.success) {\n    const { data } = result;\n    const newConf = { ...conf };\n    if (data) {\n      if (!newConf.default) {\n        newConf.default = {};\n      }\n      newConf.default.fields = data;\n      setConf(newConf);\n      if (setLoading) {\n        setLoading({ ...loading, field: false });\n        toast.success(__(\"Tag refresh successfully\"));\n      }\n    }\n    return true;\n  }\n  if (setLoading) {\n    setLoading({ ...loading, field: false });\n    toast.success(__(\"Tag refresh failed\"));\n  }\n  return false;\n};\n\nexport const generateMappedField = (mailercloudConf) => {\n  const requiredFlds = mailercloudConf?.default?.fields.filter(\n    (fld) => fld.required === true\n  );\n  return requiredFlds.length > 0\n    ? requiredFlds.map((field) => ({\n        formField: \"\",\n        mailercloudFormField: field.key,\n      }))\n    : [{ formField: \"\", mailercloudFormField: \"\" }];\n};\n\nexport const checkMappedFields = (mailercloudConf) => {\n  const mappedFields = mailercloudConf?.field_map\n    ? mailercloudConf.field_map.filter(\n        (mappedField) =>\n          !mappedField.formField ||\n          !mappedField.mailercloudFormField ||\n          (!mappedField.formField === \"custom\" && !mappedField.customValue)\n      )\n    : [];\n  if (mappedFields.length > 0) {\n    return false;\n  }\n  return true;\n};\n\nexport const nextPage = (conf, setStep, pageNo) => {\n  setTimeout(() => {\n    document.getElementById(\"btcd-settings-wrp\").scrollTop = 0;\n  }, 300);\n\n  if (!checkMappedFields(conf)) {\n    toast.error(\"Please map mandatory fields\");\n    return;\n  }\n  conf.field_map.length > 0 && setStep(pageNo);\n};\n\nexport const saveConfig = (\n  flow,\n  setFlow,\n  allIntegURL,\n  conf,\n  navigate,\n  setLoading\n) => {\n  setLoading(true);\n  const resp = saveIntegConfig(\n    flow,\n    setFlow,\n    allIntegURL,\n    conf,\n    navigate,\n    \"\",\n    \"\",\n    setLoading\n  );\n  resp.then((res) => {\n    if (res.success) {\n      toast.success(res.data?.msg);\n      navigate(allIntegURL);\n    } else {\n      toast.error(res.data || res);\n    }\n  });\n};\n\nexport const saveUpdateConfig = (\n  flow,\n  allIntegURL,\n  conf,\n  navigate,\n  edit,\n  setIsLoading\n) => {\n  if (!checkMappedFields(conf)) {\n    toast.error(\"Please map mandatory fields\");\n    return;\n  }\n  saveActionConf({ flow, allIntegURL, conf, navigate, edit, setIsLoading });\n};\n"],"names":["__","bitsFetch","saveIntegConfig","saveActionConf","handleInput","e","conf","setConf","error","setError","newConf","__spreadValues","inputError","handleAuthorize","setAuthorized","loading","setLoading","__spreadProps","requestParams","result","toast","getAllLists","__async","data","getAllFields","generateMappedField","mailercloudConf","_a","requiredFlds","fld","field","checkMappedFields","mappedField","nextPage","setStep","pageNo","saveConfig","flow","setFlow","allIntegURL","navigate","res","saveUpdateConfig","edit","setIsLoading"],"mappings":"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"}