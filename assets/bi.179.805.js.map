{"version":3,"file":"bi.179.805.js","sources":["../frontend-dev/src/components/AllIntegrations/Selzy/SelzyCommonFunc.js"],"sourcesContent":["/* eslint-disable no-unused-expressions */\n/* eslint-disable no-else-return */\n\nimport toast from \"react-hot-toast\";\nimport bitsFetch from \"../../../Utils/bitsFetch\";\nimport { __ } from \"../../../Utils/i18nwrap\";\nimport {\n  saveActionConf,\n  saveIntegConfig,\n} from \"../IntegrationHelpers/IntegrationHelpers\";\n\nexport const handleInput = (e, conf, setConf, error, setError) => {\n  const newConf = { ...conf };\n  const inputError = { ...error };\n  inputError[e.target.name] = \"\";\n  newConf[e.target.name] = e.target.value;\n  setError(inputError);\n  setConf(newConf);\n};\n\nexport const handleAuthorize = (\n  conf,\n  setConf,\n  setError,\n  setAuthorized,\n  loading,\n  setLoading\n) => {\n  if (!conf.authKey) {\n    setError({ authKey: !conf.authKey ? __(\"API key can't be empty\") : \"\" });\n    return;\n  }\n  setError({});\n  setLoading({ ...loading, auth: true });\n\n  const requestParams = { authKey: conf.authKey };\n\n  bitsFetch(requestParams, \"selzy_handle_authorize\").then((result) => {\n    if (result.success && result.data) {\n      const newConf = { ...conf };\n      if (result.data) {\n        if (!newConf.default) {\n          newConf.default = {};\n        }\n        const data = result.data.result?.map((v) => ({\n          ...v,\n          id: String(v.id),\n        }));\n        newConf.default.lists = data;\n      }\n      getAllCustomFields(newConf, setConf, loading, setLoading);\n      setConf(newConf);\n      setAuthorized(true);\n      setLoading({ ...loading, auth: false });\n      toast.success(__(\"Authorized successfully\"));\n      return;\n    }\n    setLoading({ ...loading, auth: false });\n    toast.error(__(\"Authorized failed\"));\n  });\n};\n\nexport const getAllLists = async (conf, setConf, loading, setLoading) => {\n  setLoading({ ...loading, list: true });\n  const requestParams = { authKey: conf.authKey };\n  const result = await bitsFetch(requestParams, \"selzy_handle_authorize\");\n  if (result.success) {\n    const data = result.data.result?.map((v) => ({ ...v, id: String(v.id) }));\n    const newConf = { ...conf };\n    if (data) {\n      if (!newConf.default) {\n        newConf.default = {};\n      }\n      newConf.default.lists = data;\n      setConf(newConf);\n      setLoading({ ...loading, list: false });\n      toast.success(__(\"List refresh successfully\"));\n      return;\n    }\n  }\n  setLoading({ ...loading, list: false });\n  toast.success(__(\"List refresh failed\"));\n};\n\nexport const getAllTags = async (conf, setConf, loading, setLoading) => {\n  setLoading && setLoading({ ...loading, tag: true });\n  const requestParams = { authKey: conf.authKey };\n  const result = await bitsFetch(requestParams, \"selzy_get_all_tags\");\n  if (result.success) {\n    const data = result.data.result;\n    const newConf = { ...conf };\n    if (data) {\n      if (!newConf.default) {\n        newConf.default = {};\n      }\n      newConf.default.tags = data;\n      setConf(newConf);\n      if (setLoading) {\n        setLoading({ ...loading, tag: false });\n        toast.success(__(\"Tag refresh successfully\"));\n      }\n    }\n    return true;\n  }\n  if (setLoading) {\n    setLoading({ ...loading, tag: false });\n    toast.success(__(\"Tag refresh failed\"));\n  }\n  return false;\n};\n\nexport const getAllCustomFields = async (\n  conf,\n  setConf,\n  loading,\n  setLoading\n) => {\n  setLoading && setLoading({ ...loading, customFields: true });\n  const requestParams = { authKey: conf.authKey };\n  const result = await bitsFetch(requestParams, \"selzy_get_all_custom_fields\");\n  if (result.success) {\n    const newConf = { ...conf };\n    if (result.data) {\n      if (!newConf.default) {\n        newConf.default = {};\n      }\n      newConf.default.customFields = result.data;\n      setConf(newConf);\n      if (setLoading) {\n        setLoading({ ...loading, customFields: false });\n        toast.success(__(\"Custom fileds fetched successfully\"));\n      }\n    }\n    return true;\n  }\n  if (setLoading) {\n    setLoading({ ...loading, customFields: false });\n    toast.success(__(\"Custom fileds fetching failed\"));\n  }\n  return false;\n};\n\nexport const generateMappedField = (selzyConf) => {\n  const requiredFlds = selzyConf?.selzyFields.filter(\n    (fld) => fld.required === true\n  );\n  return requiredFlds.length > 0\n    ? requiredFlds.map((field) => ({\n        formField: \"\",\n        selzyFormField: field.key,\n      }))\n    : [{ formField: \"\", selzyFormField: \"\" }];\n};\nexport const checkMappedFields = (selzyConf) => {\n  const mappedFields = selzyConf?.field_map\n    ? selzyConf.field_map.filter(\n        (mappedField) =>\n          !mappedField.formField ||\n          !mappedField.selzyFormField ||\n          (!mappedField.formField === \"custom\" && !mappedField.customValue)\n      )\n    : [];\n  if (mappedFields.length > 0) {\n    return false;\n  }\n  return true;\n};\n\nexport const nextPage = (conf, setStep, pageNo) => {\n  setTimeout(() => {\n    document.getElementById(\"btcd-settings-wrp\").scrollTop = 0;\n  }, 300);\n\n  if (!checkMappedFields(conf)) {\n    toast.error(\"Please map mandatory fields\");\n    return;\n  }\n  conf.field_map.length > 0 && setStep(pageNo);\n};\n\nexport const saveConfig = (\n  flow,\n  setFlow,\n  allIntegURL,\n  conf,\n  navigate,\n  setLoading\n) => {\n  setLoading(true);\n  const resp = saveIntegConfig(\n    flow,\n    setFlow,\n    allIntegURL,\n    conf,\n    navigate,\n    \"\",\n    \"\",\n    setLoading\n  );\n  resp.then((res) => {\n    if (res.success) {\n      toast.success(res.data?.msg);\n      navigate(allIntegURL);\n    } else {\n      toast.error(res.data || res);\n    }\n  });\n};\n\nexport const saveUpdateConfig = (\n  flow,\n  allIntegURL,\n  conf,\n  navigate,\n  edit,\n  setIsLoading\n) => {\n  if (!checkMappedFields(conf)) {\n    toast.error(\"Please map mandatory fields\");\n    return;\n  }\n  if (checkMappedFields(conf) === \"required\") {\n    toast.error(\"You must select email or phone in klaviyo fields\");\n    return;\n  }\n  saveActionConf({ flow, allIntegURL, conf, navigate, edit, setIsLoading });\n};\n"],"names":["__","bitsFetch","_t","saveIntegConfig","saveActionConf","handleInput","e","conf","setConf","error","setError","newConf","__spreadValues","inputError","handleAuthorize","setAuthorized","loading","setLoading","__spreadProps","requestParams","result","_a","data","v","getAllCustomFields","toast","getAllLists","__async","getAllTags","generateMappedField","selzyConf","requiredFlds","fld","field","checkMappedFields","mappedField","nextPage","setStep","pageNo","saveConfig","flow","setFlow","allIntegURL","navigate","res","saveUpdateConfig","edit","setIsLoading"],"mappings":"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"}