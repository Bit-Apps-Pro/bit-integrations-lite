{"version":3,"file":"bi.525.909.js","sources":["../frontend-dev/src/components/AllIntegrations/AcademyLms/AcademyLmsCommonFunc.js","../frontend-dev/src/components/AllIntegrations/AcademyLms/AcademyLmsIntegLayout.jsx"],"sourcesContent":["import toast from 'react-hot-toast'\nimport { deepCopy } from '../../../Utils/Helpers'\nimport bitsFetch from '../../../Utils/bitsFetch'\nimport { __ } from '../../../Utils/i18nwrap'\n\nexport const handleInput = (e, academyLmsConf, setAcademyLmsConf, setIsLoading, setSnackbar) => {\n  let newConf = deepCopy(academyLmsConf)\n  const { name, value } = e.target\n  newConf[name] = value\n\n  switch (name) {\n    case 'module':\n      newConf = moduleChange(newConf, setAcademyLmsConf, setIsLoading, setSnackbar)\n      break\n    default:\n      break\n  }\n  setAcademyLmsConf(newConf)\n}\n\nexport const moduleChange = (academyLmsConf, setAcademyLmsConf, setIsLoading, setSnackbar) => {\n  let newConf = deepCopy(academyLmsConf)\n  newConf.field_map = []\n\n  if (!newConf?.default?.fields?.[academyLmsConf.module]) {\n    refreshFields(newConf, setAcademyLmsConf, setIsLoading, setSnackbar)\n  } else {\n    newConf = generateMappedFields(newConf)\n  }\n\n  return newConf\n}\n\nexport const getAllCourses = (academyLmsConf, setAcademyLmsConf, setIsLoading, value = null) => {\n  setIsLoading(true)\n  const queryParams = { type: value }\n  const loadPostTypes = bitsFetch(null, 'academy_lms_all_course', queryParams, 'GET')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...academyLmsConf }\n        if (!newConf.default) newConf.default = {}\n        newConf.default.courses = result.data\n        setAcademyLmsConf({ ...newConf })\n        setIsLoading(false)\n        return 'Courses fetched successfully'\n      }\n      setIsLoading(false)\n      return 'Courses fetch failed. please try again'\n    })\n  toast.promise(loadPostTypes, {\n    success: data => data,\n    error: __('Error Occurred', 'bit-integrations'),\n    loading: __('Loading Courses...'),\n  })\n}\n\nexport const getAllLesson = (academyLmsConf, setAcademyLmsConf, setIsLoading) => {\n  setIsLoading(true)\n  const loadPostTypes = bitsFetch(null, 'academy_lms_all_lesson', '', 'GET')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...academyLmsConf }\n        if (!newConf.default) newConf.default = {}\n        newConf.default.lessons = result.data\n        setAcademyLmsConf({ ...newConf })\n        setIsLoading(false)\n        return 'Lessons fetched successfully'\n      }\n      setIsLoading(false)\n      return 'Lessons fetch failed, please try again...'\n    })\n  toast.promise(loadPostTypes, {\n    success: data => data,\n    error: __('Error Occurred', 'bit-integrations'),\n    loading: __('Loading Lessons...'),\n  })\n}\n\nconst generateMappedFields = academyLmsConf => {\n  const newConf = deepCopy(academyLmsConf)\n  newConf.default.fields[newConf.module].required.forEach(reqFld => {\n    if (!newConf.field_map.find(fld => fld.wcField === reqFld)) {\n      newConf.field_map.unshift({ formField: '', wcField: reqFld, required: true })\n    }\n  })\n  if (!newConf.field_map.length) newConf.field_map = [{ formField: '', wcField: '' }]\n  return newConf\n}\n","/* eslint-disable no-unused-expressions */\nimport MultiSelect from 'react-multiple-select-dropdown-lite'\nimport { __ } from '../../../Utils/i18nwrap'\nimport Loader from '../../Loaders/Loader'\nimport { getAllCourses, getAllLesson } from './AcademyLmsCommonFunc'\nimport Note from '../../Utilities/Note'\n\nexport default function AcademyLmsIntegLayout({ academyLmsConf, setAcademyLmsConf, isLoading, setIsLoading }) {\n  const action = [\n    { value: 'enroll-course', label: 'Enroll the user in a course' },\n    { value: 'unenroll-course', label: 'Unenroll user from a course' },\n    { value: 'complete-course', label: 'Mark a course complete for the user' },\n    { value: 'complete-lesson', label: 'Mark a lesson complete for the user' },\n    { value: 'reset-course', label: 'Reset the user progress in a course' },\n  ]\n\n  const handleAction = (e) => {\n    const newConf = { ...academyLmsConf }\n    const { name, value } = e.target\n    if (e.target.value !== '') {\n      newConf[name] = value\n    } else {\n      delete newConf[name]\n    }\n    if (name === 'actionName') {\n      if (newConf?.selectedCourse) delete newConf.selectedCourse\n      if (newConf?.selectedLesson) delete newConf.selectedLesson\n      if (newConf?.selectedAllCourse) delete newConf.selectedAllCourse\n      setAcademyLmsConf({ ...newConf })\n\n      if (value !== '') {\n        getAllCourses(newConf, setAcademyLmsConf, setIsLoading, value)\n        if (value === 'complete-lesson') {\n          getAllLesson(newConf, setAcademyLmsConf, setIsLoading)\n        }\n      }\n    } else {\n      setAcademyLmsConf({ ...newConf })\n    }\n  }\n\n  const setChanges = (val, type) => {\n    const newConf = { ...academyLmsConf }\n    if (val) {\n      if (type === 'selectedCourse' && val.includes('all-course')) {\n        newConf.selectedAllCourse = newConf.default.courses\n      }\n      newConf[type] = val ? val.split(',') : []\n    } else {\n      newConf?.selectedAllCourse && delete newConf.selectedAllCourse\n    }\n    setAcademyLmsConf({ ...newConf })\n  }\n\n  return (\n    <>\n      <br />\n      <div className=\"flx\">\n        <b className=\"wdt-200 d-in-b\">{__('Action:', 'bit-integrations')}</b>\n        <select onChange={handleAction} name=\"actionName\" value={academyLmsConf?.actionName} className=\"btcd-paper-inp w-5\">\n          <option value=\"\">{__('Select Action', 'bit-integrations')}</option>\n          {\n            action.map(({ label, value }) => (\n              <option key={label} value={value}>\n                {label}\n              </option>\n            ))\n          }\n        </select>\n      </div>\n      <br />\n\n      {\n        (academyLmsConf?.actionName === 'enroll-course' || academyLmsConf?.actionName === 'unenroll-course' || academyLmsConf?.actionName === 'complete-course' || academyLmsConf?.actionName === 'reset-course' || academyLmsConf?.actionName === 'complete-lesson')\n        && (\n          <div className=\"flx\">\n            <b className=\"wdt-200 d-in-b\">{__('Select Course: ', 'bit-integrations')}</b>\n            <MultiSelect\n              defaultValue={academyLmsConf?.selectedCourse}\n              className=\"btcd-paper-drpdwn w-5\"\n              options={academyLmsConf?.default?.courses && academyLmsConf.default.courses.map(course => ({ label: course.courseTitle, value: course.courseId.toString() }))}\n              onChange={val => setChanges(val, 'selectedCourse')}\n              singleSelect={academyLmsConf?.actionName === 'complete-course' || academyLmsConf?.actionName === 'complete-lesson' || academyLmsConf?.actionName === 'reset-course'}\n            />\n            <button onClick={() => getAllCourses(academyLmsConf, setAcademyLmsConf, setIsLoading, academyLmsConf?.actionName)} className=\"icn-btn sh-sm ml-2 mr-2 tooltip\" style={{ '--tooltip-txt': `${__('Refresh Courses', 'bit-integrations')}'` }} type=\"button\" disabled={isLoading}>&#x21BB;</button>\n          </div>\n        )\n      }\n      <br />\n      {\n        (academyLmsConf?.actionName === 'complete-lesson')\n        && (\n\n          <div className=\"flx\">\n            <b className=\"wdt-200 d-in-b\">{__('Select Lessons: ', 'bit-integrations')}</b>\n            <MultiSelect\n              defaultValue={academyLmsConf?.selectedLesson}\n              className=\"btcd-paper-drpdwn w-5\"\n              options={academyLmsConf?.default?.lessons && academyLmsConf.default.lessons.map(lesson => ({ label: lesson.lessonTitle, value: lesson.lessonId.toString() }))}\n              onChange={val => setChanges(val, 'selectedLesson')}\n              singleSelect\n            />\n            <button onClick={() => getAllLesson(academyLmsConf, setAcademyLmsConf, setIsLoading)} className=\"icn-btn sh-sm ml-2 mr-2 tooltip\" style={{ '--tooltip-txt': `${__('Refresh Courses', 'bit-integrations')}'` }} type=\"button\" disabled={isLoading}>&#x21BB;</button>\n\n          </div>\n\n        )\n      }\n\n      <br />\n      <br />\n      {\n        isLoading && (\n          <Loader style={{\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            height: 100,\n            transform: 'scale(0.7)',\n          }}\n          />\n        )\n      }\n      <Note\n        note=\"This integration will only work for logged-in users.\"\n      />\n    </>\n  )\n}\n"],"names":["jsxRuntimeExports","Loader","deepCopy","bitsFetch","_t","__","u","Note","handleInput","academyLmsConf","setAcademyLmsConf","setIsLoading","setSnackbar","newConf","name","value","moduleChange","_a","_b","generateMappedFields","getAllCourses","loadPostTypes","result","__spreadValues","toast","data","getAllLesson","reqFld","fld","AcademyLmsIntegLayout","isLoading","action","handleAction","e","setChanges","val","type","jsxs","Fragment","jsx","label","MultiSelect","course","lesson"],"mappings":"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"}