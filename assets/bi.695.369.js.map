{"version":3,"file":"bi.695.369.js","sources":["../frontend-dev/src/components/AllIntegrations/Registration/Registration.jsx"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport { useEffect, useState } from 'react'\nimport 'react-multiple-select-dropdown-lite/dist/index.css'\nimport { useNavigate, useParams } from 'react-router-dom'\nimport bitsFetch from '../../../Utils/bitsFetch'\nimport { __ } from '../../../Utils/i18nwrap'\nimport SnackMsg from '../../Utilities/SnackMsg'\nimport { saveIntegConfig } from '../IntegrationHelpers/IntegrationHelpers'\nimport UserFieldMap from './UserFieldMap'\nimport UserMetaField from './UserMetaField'\nimport { userFields } from '../../../Utils/StaticData/userField'\nimport { checkMappedUserFields } from './UserHelperFunction'\nimport LoaderSm from '../../Loaders/LoaderSm'\nimport ConditionalLogic from '../../ConditionalLogic'\nimport TableCheckBox from '../../Utilities/TableCheckBox'\nimport CheckBox from '../../Utilities/CheckBox'\nimport Note from '../../Utilities/Note'\nimport tutorialLinks from '../../../Utils/StaticData/tutorialLinks'\nimport TutorialLink from '../../Utilities/TutorialLink'\n\nexport default function Registration({ formFields, setFlow, flow, allIntegURL }) {\n  const { formID } = useParams()\n  const [snack, setSnackbar] = useState({ show: false })\n  const [roles, setRoles] = useState([])\n  const navigate = useNavigate()\n  const [isLoading, setIsLoading] = useState(false)\n  const { registration } = tutorialLinks\n\n  const [userConf, setUserConf] = useState({\n    name: 'User Registration',\n    type: 'Registration',\n    user_map: [{}],\n    meta_map: [{}],\n    condition:\n    {\n      action_behavior: '',\n      actions: [{ field: '', action: 'value' }],\n      logics: [\n        { field: '', logic: '', val: '' },\n        'or',\n        { field: '', logic: '', val: '' },\n      ],\n    },\n  })\n\n  useEffect(() => {\n    const tmpConf = { ...userConf }\n    bitsFetch({}, 'role/list', null, 'GET').then((res) => {\n      if (res?.success && res !== undefined) {\n        setRoles(Object.values(res?.data))\n      }\n    })\n    if (!tmpConf?.user_map?.[0]?.userField) {\n      tmpConf.user_map = userFields.filter(fld => fld.required).map(fl => ({ formField: '', userField: fl.key, required: fl.required }))\n    }\n\n    setUserConf(tmpConf)\n  }, [])\n  const saveConfig = () => {\n    if (!userConf.action_type) {\n      setSnackbar({ show: true, msg: __('Please select action type', 'bit-integrations') })\n      return\n    }\n    if (!userConf.user_role && userConf.action_type !== 'updated_user') {\n      setSnackbar({ show: true, msg: __('User Role cann\\'t be empty', 'bit-integrations') })\n      return\n    }\n    if (!checkMappedUserFields(userConf) && userConf.action_type !== 'updated_user') {\n      setSnackbar({ show: true, msg: __('Please map mandatory fields', 'bit-integrations') })\n      return\n    }\n    setIsLoading(true)\n    saveIntegConfig(flow, setFlow, allIntegURL, userConf, navigate, '', '', setIsLoading)\n  }\n\n  const checkedCondition = (val, checked) => {\n    const tmpConf = { ...userConf }\n    if (checked) {\n      tmpConf.condition.action_behavior = val\n    } else {\n      tmpConf.condition.action_behavior = ''\n    }\n    setUserConf(tmpConf)\n  }\n\n  const actionHandler = (e) => {\n    const newConf = { ...userConf }\n    const { name, value } = e.target\n    if (e.target.checked) {\n      newConf[name] = value\n    }\n    setUserConf({ ...newConf })\n  }\n\n  const userUpdateInstruction = `\n  <ul>\n  <li>The user must be logged in when updating profile</li>\n  <li>The user cannot change the value of the username field when updating the user profile.</li>\n     \n  </ul>`\n  const userCreateInstruction = `\n  <ul>\n  <li>If the Username and Password fields are blank then the user will take the value of the email field as the field and the password will be auto-generated.</li>\n     \n  </ul>`\n\n  return (\n    <div style={{ width: 900 }}>\n      <SnackMsg snack={snack} setSnackbar={setSnackbar} />\n      {registration?.youTubeLink && (\n        <TutorialLink\n          title={registration?.title}\n          youTubeLink={registration?.youTubeLink}\n        />\n      )}\n      {registration?.docLink && (\n        <TutorialLink\n          title={registration?.title}\n          docLink={registration?.docLink}\n        />\n      )}\n\n      <div className=\"font-w-m mt-3\">{__('Action type', 'bit-integrations')}</div>\n      <div>\n        <CheckBox radio name=\"action_type\" onChange={actionHandler} checked={userConf?.action_type === 'new_user'} value=\"new_user\" title={__('New User Create', 'bit-integrations')} />\n        <CheckBox radio name=\"action_type\" onChange={actionHandler} checked={userConf?.action_type === 'updated_user'} value=\"updated_user\" title={__('Updated User', 'bit-integrations')} />\n      </div>\n      <div>\n\n        <UserFieldMap\n          formFields={formFields}\n          formID={formID}\n          userConf={userConf}\n          setUserConf={setUserConf}\n          roles={roles}\n          userFields={userFields}\n        />\n      </div>\n      <div>\n        <UserMetaField\n          formFields={formFields}\n          formID={formID}\n          userConf={userConf}\n          setUserConf={setUserConf}\n        />\n        <br />\n      </div>\n\n      {userConf?.condition && (\n        <>\n          <div className=\"flx\">\n            <TableCheckBox onChange={e => checkedCondition(e.target.value, e.target.checked)} checked={userConf?.condition?.action_behavior === 'cond'} className=\"wdt-200 mt-4 mr-2\" value=\"cond\" title={__('Conditional Logics', 'bit_integration')} />\n          </div>\n          <br />\n          {userConf?.condition?.action_behavior === 'cond' && (\n\n            <ConditionalLogic formFields={formFields} dataConf={userConf} setDataConf={setUserConf} />\n          )}\n        </>\n      )}\n      {userConf?.action_type === 'updated_user' ? (\n        <Note note={userUpdateInstruction} />\n      ) : (\n        <Note note={userCreateInstruction} />\n      )}\n      <button\n        className=\"btn f-left btcd-btn-lg green sh-sm flx\"\n        type=\"button\"\n        onClick={() => saveConfig()}\n        disabled={isLoading}\n      >\n        {__('Save', 'bit-integrations')}\n        {isLoading && <LoaderSm size={20} clr=\"#022217\" className=\"ml-2\" />}\n      </button>\n\n    </div>\n  )\n}\n"],"names":["Registration","formFields","setFlow","flow","allIntegURL","formID","useParams","snack","setSnackbar","useState","roles","setRoles","navigate","useNavigate","isLoading","setIsLoading","registration","tutorialLinks","userConf","setUserConf","useEffect","tmpConf","__spreadValues","bitsFetch","res","_b","_a","userFields","fld","fl","saveConfig","__","checkMappedUserFields","saveIntegConfig","checkedCondition","val","checked","actionHandler","e","newConf","name","value","userUpdateInstruction","userCreateInstruction","jsx","SnackMsg","TutorialLink","CheckBox","UserFieldMap","UserMetaField","jsxs","Fragment","TableCheckBox","ConditionalLogic","Note","LoaderSm"],"mappings":"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"}