{"version":3,"file":"bi.13.711.js","sources":["../frontend-dev/src/components/AllIntegrations/ZohoMarketingHub/ZohoMarketingHubCommonFunc.js"],"sourcesContent":["import { __ } from '../../../Utils/i18nwrap'\nimport bitsFetch from '../../../Utils/bitsFetch'\n\nexport const handleInput = (e, formID, marketingHubConf, setMarketingHubConf, setIsLoading, setSnackbar, isNew, error, setError) => {\n  let newConf = { ...marketingHubConf }\n  if (isNew) {\n    const rmError = { ...error }\n    rmError[e.target.name] = ''\n    setError({ ...rmError })\n  }\n  newConf[e.target.name] = e.target.value\n\n  switch (e.target.name) {\n    case 'list':\n      newConf = listChange(newConf, formID, setMarketingHubConf, setIsLoading, setSnackbar)\n      break\n    default:\n      break\n  }\n  setMarketingHubConf({ ...newConf })\n}\n\nexport const listChange = (marketingHubConf, formID, setMarketingHubConf, setIsLoading, setSnackbar) => {\n  const newConf = { ...marketingHubConf }\n  newConf.field_map = [{ formField: '', zohoFormField: 'Contact Email' }]\n\n  if (!newConf?.default?.fields?.[newConf.list]) {\n    refreshContactFields(formID, newConf, setMarketingHubConf, setIsLoading, setSnackbar)\n  }\n  return newConf\n}\n\nexport const refreshLists = (formID, marketingHubConf, setMarketingHubConf, setIsLoading, setSnackbar) => {\n  setIsLoading(true)\n  const refreshListsRequestParams = {\n    formID,\n    id: marketingHubConf.id,\n    dataCenter: marketingHubConf.dataCenter,\n    clientId: marketingHubConf.clientId,\n    clientSecret: marketingHubConf.clientSecret,\n    tokenDetails: marketingHubConf.tokenDetails,\n  }\n  bitsFetch(refreshListsRequestParams, 'zmarketingHub_refresh_lists')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...marketingHubConf }\n        if (result.data.lists) {\n          newConf.default = { ...newConf.default, lists: result.data.lists }\n        }\n        if (result.data.tokenDetails) {\n          newConf.tokenDetails = result.data.tokenDetails\n        }\n        setSnackbar({ show: true, msg: __('Lists refreshed', 'bit-integrations') })\n        setMarketingHubConf({ ...newConf })\n      } else if ((result && result.data && result.data.data) || (!result.success && typeof result.data === 'string')) {\n        setSnackbar({ show: true, msg: `${__('Lists refresh failed Cause:')}${result.data.data || result.data}. ${__('please try again', 'bit-integrations')}` })\n      } else {\n        setSnackbar({ show: true, msg: __('Lists refresh failed. please try again', 'bit-integrations') })\n      }\n      setIsLoading(false)\n    })\n    .catch(() => setIsLoading(false))\n}\n\nexport const refreshContactFields = (formID, marketingHubConf, setMarketingHubConf, setIsLoading, setSnackbar) => {\n  const { list } = marketingHubConf\n  if (!list) {\n    return\n  }\n\n  setIsLoading(true)\n  const refreshContactFieldsRequestParams = {\n    formID,\n    list,\n    dataCenter: marketingHubConf.dataCenter,\n    clientId: marketingHubConf.clientId,\n    clientSecret: marketingHubConf.clientSecret,\n    tokenDetails: marketingHubConf.tokenDetails,\n  }\n  bitsFetch(refreshContactFieldsRequestParams, 'zmarketingHub_refresh_contact_fields')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...marketingHubConf }\n        if (result.data.fields) {\n          if (!newConf.default.fields) {\n            newConf.default.fields = {}\n          }\n\n          newConf.default.fields[list] = result.data\n\n          setSnackbar({ show: true, msg: __('Contact Fields refreshed', 'bit-integrations') })\n        } else {\n          setSnackbar({ show: true, msg: __(\"Zoho didn't provide fields names for this list\", 'bit-integrations') })\n        }\n\n        if (result.data.tokenDetails) {\n          newConf.tokenDetails = result.data.tokenDetails\n        }\n        setMarketingHubConf({ ...newConf })\n      } else {\n        setSnackbar({ show: true, msg: __('Contact Fields refresh failed. please try again', 'bit-integrations') })\n      }\n      setIsLoading(false)\n    })\n    .catch(() => setIsLoading(false))\n}\n\nexport const checkMappedFields = (marketingHubConf) => {\n  const mappedFields = marketingHubConf?.field_map ? marketingHubConf.field_map.filter(mappedField => (!mappedField.formField && mappedField.zohoFormField && marketingHubConf?.default?.fields?.[marketingHubConf.list]?.required.indexOf(mappedField.zohoFormField) !== -1)) : []\n  if (mappedFields.length > 0) {\n    return false\n  }\n\n  return true\n}\n\nexport const setGrantTokenResponse = () => {\n  const grantTokenResponse = {}\n  const authWindowLocation = window.location.href\n  const queryParams = authWindowLocation.replace(`${window.opener.location.href}/redirect`, '').split('&')\n  if (queryParams) {\n    queryParams.forEach(element => {\n      const gtKeyValue = element.split('=')\n      if (gtKeyValue[1]) {\n        // eslint-disable-next-line prefer-destructuring\n        grantTokenResponse[gtKeyValue[0]] = gtKeyValue[1]\n      }\n    })\n  }\n  localStorage.setItem('__zohoMarkatingHub', JSON.stringify(grantTokenResponse))\n  window.close()\n}\n"],"names":["handleInput","formID","marketingHubConf","setMarketingHubConf","setIsLoading","setSnackbar","isNew","error","setError","newConf","__spreadValues","rmError","listChange","_b","_a","refreshContactFields","refreshLists","refreshListsRequestParams","bitsFetch","result","__spreadProps","__","list","refreshContactFieldsRequestParams","checkMappedFields","mappedField","_c","setGrantTokenResponse","grantTokenResponse","queryParams","element","gtKeyValue"],"mappings":"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"}