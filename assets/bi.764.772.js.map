{"version":3,"file":"bi.764.772.js","sources":["../frontend-dev/src/components/AllIntegrations/Zoom/ZoomCommonFunc.js"],"sourcesContent":["import { __, sprintf } from '../../../Utils/i18nwrap'\nimport bitsFetch from '../../../Utils/bitsFetch'\nimport { deepCopy } from '../../../Utils/Helpers'\n\nexport const handleInput = (e, zoomConf, setZoomConf, formID, setIsLoading, setSnackbar, isNew, error, setError) => {\n  let newConf = { ...zoomConf }\n  if (isNew) {\n    const rmError = { ...error }\n    rmError[e.target.name] = ''\n    setError({ ...rmError })\n  }\n  newConf[e.target.name] = e.target.value\n  switch (e.target.name) {\n    case 'spreadsheetId':\n      newConf = spreadSheetChange(newConf, formID, setZoomConf, setIsLoading, setSnackbar)\n      break\n    case 'worksheetName':\n      newConf = worksheetChange(newConf, formID, setZoomConf, setIsLoading, setSnackbar)\n      break\n    default:\n      break\n  }\n  setZoomConf({ ...newConf })\n}\nexport const zoomAllMeeting = (formID, zoomConf, setZoomConf, setIsLoading, setSnackbar) => {\n  setIsLoading(true)\n  const fetchMeetingModulesRequestParams = {\n    formID,\n    clientId: zoomConf.clientId,\n    accessToken: zoomConf.tokenDetails.access_token,\n    clientSecret: zoomConf.clientSecret,\n    refreshToken: zoomConf.tokenDetails.refresh_token,\n    tokenDetails: zoomConf.tokenDetails,\n  }\n  bitsFetch(fetchMeetingModulesRequestParams, 'zoom_fetch_all_meetings')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...zoomConf }\n        if (!newConf.default) {\n          newConf.default = {}\n        }\n        if (result.data.allMeeting) {\n          newConf.default.allMeeting = result.data.allMeeting\n        }\n        // if (result.data.tokenDetails) {\n        //   newConf.tokenDetails = result.data.tokenDetails\n        // }\n        setSnackbar({ show: true, msg: __('Meeting list refreshed', 'bit-integrations') })\n        setZoomConf({ ...newConf })\n      } else if ((result && result.data && result.data.data) || (!result.success && typeof result.data === 'string')) {\n        setSnackbar({ show: true, msg: sprintf(__('All Meeting list refresh failed Cause: %s. please try again', 'bit-integrations'), result.data.data || result.data) })\n      } else {\n        setSnackbar({ show: true, msg: __('All Meeting list failed. please try again', 'bit-integrations') })\n      }\n      setIsLoading(false)\n    })\n    .catch(() => setIsLoading(false))\n}\n\nexport const handleAuthorize = (confTmp, setConf, setError, setisAuthorized, setIsLoading, setSnackbar) => {\n  if (!confTmp.clientId || !confTmp.clientSecret) {\n    setError({\n      clientId: !confTmp.clientId ? __('Client ID cann\\'t be empty', 'bit-integrations') : '',\n      clientSecret: !confTmp.clientSecret ? __('Secret key cann\\'t be empty', 'bit-integrations') : '',\n    })\n    return\n  }\n  setIsLoading(true)\n  const apiEndpoint = `https://zoom.us/oauth/authorize?response_type=code&client_id=${confTmp.clientId}&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(`${btcbi.api.base}/redirect`)}`\n  const authWindow = window.open(apiEndpoint, 'zoom', 'width=400,height=609,toolbar=off')\n  const popupURLCheckTimer = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(popupURLCheckTimer)\n      let grantTokenResponse = {}\n      let isauthRedirectLocation = false\n      const bitsGoogleSheet = localStorage.getItem('__zoom')\n      if (bitsGoogleSheet) {\n        isauthRedirectLocation = true\n        grantTokenResponse = JSON.parse(bitsGoogleSheet)\n        localStorage.removeItem('__zoom')\n      }\n      if (!grantTokenResponse.code || grantTokenResponse.error || !grantTokenResponse || !isauthRedirectLocation) {\n        const errorCause = grantTokenResponse.error ? `Cause: ${grantTokenResponse.error}` : ''\n        setSnackbar({ show: true, msg: `${__('Authorization failed', 'bit-integrations')} ${errorCause}. ${__('please try again', 'bit-integrations')}` })\n        setIsLoading(false)\n      } else {\n        const newConf = { ...confTmp }\n        newConf.accountServer = grantTokenResponse['accounts-server']\n        tokenHelper(grantTokenResponse, newConf, setConf, setisAuthorized, setIsLoading, setSnackbar)\n      }\n    }\n  }, 500)\n}\n\nconst tokenHelper = (grantToken, confTmp, setConf, setisAuthorized, setIsLoading, setSnackbar) => {\n  const tokenRequestParams = { ...grantToken }\n  tokenRequestParams.clientId = confTmp.clientId\n  tokenRequestParams.clientSecret = confTmp.clientSecret\n  // eslint-disable-next-line no-undef\n  tokenRequestParams.redirectURI = `${btcbi.api.base}/redirect`\n  bitsFetch(tokenRequestParams, 'zoom_generate_token')\n    .then(result => result)\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...confTmp }\n        newConf.tokenDetails = result.data\n        setConf(newConf)\n        setisAuthorized(true)\n        setSnackbar({ show: true, msg: __('Authorized Successfully', 'bit-integrations') })\n      } else if ((result && result.data && result.data.data) || (!result.success && typeof result.data === 'string')) {\n        setSnackbar({ show: true, msg: `${__('Authorization failed Cause:', 'bit-integrations')}${result.data.data || result.data}. ${__('please try again', 'bit-integrations')}` })\n      } else {\n        setSnackbar({ show: true, msg: __('Authorization failed. please try again', 'bit-integrations') })\n      }\n      setIsLoading(false)\n    })\n}\n\nexport const checkMappedFields = (zoomConf) => {\n  const mappedFleld = zoomConf.field_map ? zoomConf.field_map.filter(mapped => (!mapped.formField && !mapped.zoomConf)) : []\n  if (mappedFleld.length > 0) {\n    return false\n  }\n  return true\n}\n\nexport const generateMappedField = (zoomConf) => {\n  const requiredFlds = zoomConf?.zoomFields.filter(fld => fld.required === true)\n  return requiredFlds.length > 0 ? requiredFlds.map(field => ({ formField: '', zoomField: field.key })) : [{ formField: '', zoomField: '' }]\n}\n"],"names":["handleInput","zoomConf","setZoomConf","formID","setIsLoading","setSnackbar","isNew","error","setError","newConf","__spreadValues","rmError","zoomAllMeeting","fetchMeetingModulesRequestParams","bitsFetch","result","__","sprintf","handleAuthorize","confTmp","setConf","setisAuthorized","apiEndpoint","authWindow","popupURLCheckTimer","grantTokenResponse","isauthRedirectLocation","bitsGoogleSheet","errorCause","tokenHelper","grantToken","tokenRequestParams","checkMappedFields","mapped","generateMappedField","requiredFlds","fld","field"],"mappings":"2YAIY,MAACA,EAAc,CAAC,EAAGC,EAAUC,EAAaC,EAAQC,EAAcC,EAAaC,EAAOC,EAAOC,IAAa,CAClH,IAAIC,EAAUC,EAAA,GAAKT,GACnB,GAAIK,EAAO,CACT,MAAMK,EAAUD,EAAA,GAAKH,GACrBI,EAAQ,EAAE,OAAO,IAAI,EAAI,GACzBH,EAASE,EAAA,GAAKC,EAAS,CACxB,CAED,OADAF,EAAQ,EAAE,OAAO,IAAI,EAAI,EAAE,OAAO,MAC1B,EAAE,OAAO,KAAI,CACnB,IAAK,gBACHA,EAAU,kBAAkBA,EAASN,EAAQD,EAAaE,EAAcC,CAAW,EACnF,MACF,IAAK,gBACHI,EAAU,gBAAgBA,EAASN,EAAQD,EAAaE,EAAcC,CAAW,EACjF,KAGH,CACDH,EAAYQ,EAAA,GAAKD,EAAS,CAC5B,EACaG,EAAiB,CAACT,EAAQF,EAAUC,EAAaE,EAAcC,IAAgB,CAC1FD,EAAa,EAAI,EACjB,MAAMS,EAAmC,CACvC,OAAAV,EACA,SAAUF,EAAS,SACnB,YAAaA,EAAS,aAAa,aACnC,aAAcA,EAAS,aACvB,aAAcA,EAAS,aAAa,cACpC,aAAcA,EAAS,YACxB,EACDa,EAAUD,EAAkC,yBAAyB,EAClE,KAAKE,GAAU,CACd,GAAIA,GAAUA,EAAO,QAAS,CAC5B,MAAMN,EAAUC,EAAA,GAAKT,GAChBQ,EAAQ,UACXA,EAAQ,QAAU,CAAE,GAElBM,EAAO,KAAK,aACdN,EAAQ,QAAQ,WAAaM,EAAO,KAAK,YAK3CV,EAAY,CAAE,KAAM,GAAM,IAAKW,EAAG,yBAA0B,kBAAkB,EAAG,EACjFd,EAAYQ,EAAA,GAAKD,EAAS,CAC3B,MAAWM,GAAUA,EAAO,MAAQA,EAAO,KAAK,MAAU,CAACA,EAAO,SAAW,OAAOA,EAAO,MAAS,SACnGV,EAAY,CAAE,KAAM,GAAM,IAAKY,EAAQD,EAAG,8DAA+D,kBAAkB,EAAGD,EAAO,KAAK,MAAQA,EAAO,IAAI,EAAG,EAEhKV,EAAY,CAAE,KAAM,GAAM,IAAKW,EAAG,4CAA6C,kBAAkB,EAAG,EAEtGZ,EAAa,EAAK,CACxB,CAAK,EACA,MAAM,IAAMA,EAAa,EAAK,CAAC,CACpC,EAEac,EAAkB,CAACC,EAASC,EAASZ,EAAUa,EAAiBjB,EAAcC,IAAgB,CACzG,GAAI,CAACc,EAAQ,UAAY,CAACA,EAAQ,aAAc,CAC9CX,EAAS,CACP,SAAWW,EAAQ,SAAkE,GAAvDH,EAAG,4BAA8B,kBAAkB,EACjF,aAAeG,EAAQ,aAAuE,GAAxDH,EAAG,6BAA+B,kBAAkB,CAChG,CAAK,EACD,MACD,CACDZ,EAAa,EAAI,EACjB,MAAMkB,EAAc,gEAAgEH,EAAQ,QAAQ,UAAU,mBAAmB,OAAO,SAAS,IAAI,CAAC,0BAA0B,mBAAmB,GAAG,MAAM,IAAI,IAAI,WAAW,CAAC,GAC1NI,EAAa,OAAO,KAAKD,EAAa,OAAQ,kCAAkC,EAChFE,EAAqB,YAAY,IAAM,CAC3C,GAAID,EAAW,OAAQ,CACrB,cAAcC,CAAkB,EAChC,IAAIC,EAAqB,CAAE,EACvBC,EAAyB,GAC7B,MAAMC,EAAkB,aAAa,QAAQ,QAAQ,EAMrD,GALIA,IACFD,EAAyB,GACzBD,EAAqB,KAAK,MAAME,CAAe,EAC/C,aAAa,WAAW,QAAQ,GAE9B,CAACF,EAAmB,MAAQA,EAAmB,OAAS,CAACA,GAAsB,CAACC,EAAwB,CAC1G,MAAME,EAAaH,EAAmB,MAAQ,UAAUA,EAAmB,KAAK,GAAK,GACrFpB,EAAY,CAAE,KAAM,GAAM,IAAK,GAAGW,EAAG,uBAAwB,kBAAkB,CAAC,IAAIY,CAAU,KAAKZ,EAAG,mBAAoB,kBAAkB,CAAC,GAAI,EACjJZ,EAAa,EAAK,CAC1B,KAAa,CACL,MAAMK,EAAUC,EAAA,GAAKS,GACrBV,EAAQ,cAAgBgB,EAAmB,iBAAiB,EAC5DI,EAAYJ,EAAoBhB,EAASW,EAASC,EAAiBjB,EAAcC,CAAW,CAC7F,CACF,CACF,EAAE,GAAG,CACR,EAEMwB,EAAc,CAACC,EAAYX,EAASC,EAASC,EAAiBjB,EAAcC,IAAgB,CAChG,MAAM0B,EAAqBrB,EAAA,GAAKoB,GAChCC,EAAmB,SAAWZ,EAAQ,SACtCY,EAAmB,aAAeZ,EAAQ,aAE1CY,EAAmB,YAAc,GAAG,MAAM,IAAI,IAAI,YAClDjB,EAAUiB,EAAoB,qBAAqB,EAChD,KAAKhB,GAAUA,CAAM,EACrB,KAAKA,GAAU,CACd,GAAIA,GAAUA,EAAO,QAAS,CAC5B,MAAMN,EAAUC,EAAA,GAAKS,GACrBV,EAAQ,aAAeM,EAAO,KAC9BK,EAAQX,CAAO,EACfY,EAAgB,EAAI,EACpBhB,EAAY,CAAE,KAAM,GAAM,IAAKW,EAAG,0BAA2B,kBAAkB,EAAG,CACnF,MAAWD,GAAUA,EAAO,MAAQA,EAAO,KAAK,MAAU,CAACA,EAAO,SAAW,OAAOA,EAAO,MAAS,SACnGV,EAAY,CAAE,KAAM,GAAM,IAAK,GAAGW,EAAG,8BAA+B,kBAAkB,CAAC,GAAGD,EAAO,KAAK,MAAQA,EAAO,IAAI,KAAKC,EAAG,mBAAoB,kBAAkB,CAAC,GAAI,EAE5KX,EAAY,CAAE,KAAM,GAAM,IAAKW,EAAG,yCAA0C,kBAAkB,EAAG,EAEnGZ,EAAa,EAAK,CACxB,CAAK,CACL,EAEa4B,EAAqB/B,GAE5B,GADgBA,EAAS,UAAYA,EAAS,UAAU,OAAOgC,GAAW,CAACA,EAAO,WAAa,CAACA,EAAO,QAAS,EAAI,CAAE,GAC1G,OAAS,GAMdC,EAAuBjC,GAAa,CAC/C,MAAMkC,EAAelC,GAAA,YAAAA,EAAU,WAAW,OAAOmC,GAAOA,EAAI,WAAa,IACzE,OAAOD,EAAa,OAAS,EAAIA,EAAa,IAAIE,IAAU,CAAE,UAAW,GAAI,UAAWA,EAAM,GAAK,EAAC,EAAI,CAAC,CAAE,UAAW,GAAI,UAAW,GAAI,CAC3I"}