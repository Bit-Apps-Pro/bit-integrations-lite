{"version":3,"file":"bi.652.903.js","sources":["../frontend-dev/src/components/AllIntegrations/PerfexCRM/PerfexCRMCommonFunc.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable no-else-return */\nimport { create } from \"mutative\";\nimport toast from \"react-hot-toast\";\nimport bitsFetch from \"../../../Utils/bitsFetch\";\nimport { __ } from \"../../../Utils/i18nwrap\";\n\nexport const handleInput = (e, perfexCRMConf, setPerfexCRMConf) => {\n  const newConf = { ...perfexCRMConf };\n  const { name } = e.target;\n  if (e.target.value !== \"\") {\n    newConf[name] = e.target.value;\n  } else {\n    delete newConf[name];\n  }\n  setPerfexCRMConf({ ...newConf });\n};\n\n// refreshMappedFields\nexport const refreshCustomFields = (\n  perfexCRMConf,\n  setPerfexCRMConf,\n  setIsLoading,\n  setSnackbar\n) => {\n  setIsLoading(true);\n  const requestParams = {\n    api_token: perfexCRMConf.api_token,\n    domain: perfexCRMConf.domain,\n    action_name: perfexCRMConf.actionName,\n  };\n\n  bitsFetch(requestParams, \"perfexcrm_custom_fields\")\n    .then((result) => {\n      if (result && result.success) {\n        setPerfexCRMConf((prevPerfexCRMConf) =>\n          create(prevPerfexCRMConf, (draftConf) => {\n            draftConf.perfexCRMFields = \"\";\n            draftConf.field_map = [{ formField: \"\", perfexCRMFormField: \"\" }];\n\n            if (result.data) {\n              if (draftConf.actionName === \"customer\") {\n                draftConf.perfexCRMFields = draftConf.customerFields;\n              } else if (draftConf.actionName === \"contact\") {\n                draftConf.perfexCRMFields = draftConf.contactFields;\n              } else if (draftConf.actionName === \"lead\") {\n                draftConf.perfexCRMFields = draftConf.leadFields;\n              } else if (draftConf.actionName === \"project\") {\n                draftConf.perfexCRMFields = draftConf.projectFields;\n              }\n\n              draftConf.perfexCRMFields = [\n                ...draftConf.perfexCRMFields,\n                ...result.data,\n              ];\n              draftConf.field_map = generateMappedField(draftConf);\n            }\n\n            return draftConf;\n          })\n        );\n\n        setSnackbar({\n          show: true,\n          msg: __(\"Custom fields refreshed\", \"bit-integrations\"),\n        });\n      } else {\n        setSnackbar({\n          show: true,\n          msg: __(\n            \"Custom fields refresh failed. please try again\",\n            \"bit-integrations\"\n          ),\n        });\n      }\n      setIsLoading(false);\n    })\n    .catch(() => setIsLoading(false));\n};\n\nexport const generateMappedField = (perfexCRMConf) => {\n  const requiredFlds =\n    perfexCRMConf?.perfexCRMFields &&\n    perfexCRMConf?.perfexCRMFields.filter(\n      (fld) =>\n        fld.required === true && fld.key !== \"owner\" && fld.key !== \"pipeline\"\n    );\n  return requiredFlds.length > 0\n    ? requiredFlds.map((field) => ({\n        formField: \"\",\n        perfexCRMFormField: field.key,\n      }))\n    : [{ formField: \"\", perfexCRMFormField: \"\" }];\n};\n\nexport const checkMappedFields = (perfexCRMConf) => {\n  const mappedFields = perfexCRMConf?.field_map\n    ? perfexCRMConf.field_map.filter(\n        (mappedField) =>\n          !mappedField.formField ||\n          !mappedField.perfexCRMFormField ||\n          (mappedField.formField === \"custom\" && !mappedField.customValue) ||\n          (mappedField.perfexCRMFormField === \"customFieldKey\" &&\n            !mappedField.customFieldKey)\n      )\n    : [];\n  if (mappedFields.length > 0) {\n    return false;\n  }\n  return true;\n};\n\nexport const perfexCRMAuthentication = (\n  confTmp,\n  setConf,\n  setError,\n  setIsAuthorized,\n  loading,\n  setLoading\n) => {\n  if (!confTmp.api_token || !confTmp.domain) {\n    setError({\n      api_token: !confTmp.api_token\n        ? __(\"Api Token can't be empty\", \"bit-integrations\")\n        : \"\",\n      domain: !confTmp.domain\n        ? __(\"Access API URL can't be empty\", \"bit-integrations\")\n        : \"\",\n    });\n    return;\n  }\n\n  setError({});\n  setLoading({ ...loading, auth: true });\n\n  const requestParams = {\n    api_token: confTmp.api_token,\n    domain: confTmp.domain,\n  };\n\n  bitsFetch(requestParams, \"perfexcrm_authentication\").then((result) => {\n    if (result && result.success) {\n      setIsAuthorized(true);\n      setLoading({ ...loading, auth: false });\n      toast.success(__(\"Authorized successfully\", \"bit-integrations\"));\n      return;\n    }\n    setLoading({ ...loading, auth: false });\n    toast.error(\n      __(\n        \"Authorized failed, Please enter valid API Token or Access API URL\",\n        \"bit-integrations\"\n      )\n    );\n  });\n};\n\nexport const getAllCustomer = (confTmp, setConf, loading, setLoading) => {\n  setLoading({ ...loading, customers: true });\n\n  const requestParams = {\n    api_token: confTmp.api_token,\n    domain: confTmp.domain,\n  };\n\n  bitsFetch(requestParams, \"perfexcrm_fetch_all_customers\").then((result) => {\n    if (result && result.success) {\n      setConf((prevConf) =>\n        create(prevConf, (draftConf) => {\n          if (result.data) {\n            draftConf.customers = result.data;\n          }\n        })\n      );\n      setLoading({ ...loading, customers: false });\n\n      toast.success(__(\"Customer fetched successfully\", \"bit-integrations\"));\n      return;\n    }\n    setLoading({ ...loading, customers: false });\n    toast.error(__(\"Customer Not Found!\", \"bit-integrations\"));\n  });\n};\nexport const getAllLeads = (confTmp, setConf, loading, setLoading) => {\n  setLoading({ ...loading, leads: true });\n\n  const requestParams = {\n    api_token: confTmp.api_token,\n    domain: confTmp.domain,\n  };\n\n  bitsFetch(requestParams, \"perfexcrm_fetch_all_leads\").then((result) => {\n    if (result && result.success) {\n      setConf((prevConf) =>\n        create(prevConf, (draftConf) => {\n          if (result.data) {\n            draftConf.leads = result.data;\n          }\n        })\n      );\n      setLoading({ ...loading, leads: false });\n\n      toast.success(__(\"Lead fetched successfully\", \"bit-integrations\"));\n      return;\n    }\n    setLoading({ ...loading, leads: false });\n    toast.error(__(\"Lead Not Found!\", \"bit-integrations\"));\n  });\n};\nexport const getAllStaffs = (confTmp, setConf, loading, setLoading) => {\n  setLoading({ ...loading, staffs: true });\n\n  const requestParams = {\n    api_token: confTmp.api_token,\n    domain: confTmp.domain,\n  };\n\n  bitsFetch(requestParams, \"perfexcrm_fetch_all_staffs\").then((result) => {\n    if (result && result.success) {\n      setConf((prevConf) =>\n        create(prevConf, (draftConf) => {\n          if (result.data) {\n            draftConf.staffs = result.data;\n          }\n        })\n      );\n      setLoading({ ...loading, staffs: false });\n\n      toast.success(\n        __(\"Project Member fetched successfully\", \"bit-integrations\")\n      );\n      return;\n    }\n    setLoading({ ...loading, staffs: false });\n    toast.error(__(\"Project Member Not Found!\", \"bit-integrations\"));\n  });\n};\n"],"names":["__","bitsFetch","_t","create","handleInput","perfexCRMConf","setPerfexCRMConf","newConf","__spreadValues","name","refreshCustomFields","setIsLoading","setSnackbar","requestParams","result","prevPerfexCRMConf","draftConf","generateMappedField","requiredFlds","fld","field","checkMappedFields","mappedField","perfexCRMAuthentication","confTmp","setConf","setError","setIsAuthorized","loading","setLoading","__spreadProps","toast","getAllCustomer","prevConf","getAllLeads","getAllStaffs"],"mappings":"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"}