{"version":3,"file":"bi.63.825.js","sources":["../frontend-dev/src/components/AllIntegrations/Mailup/MailupCommonFunc.js"],"sourcesContent":["/* eslint-disable no-console */\nimport toast from 'react-hot-toast'\nimport bitsFetch from '../../../Utils/bitsFetch'\nimport { deepCopy } from '../../../Utils/Helpers'\nimport { sprintf, __ } from '../../../Utils/i18nwrap'\n\nexport const handleInput = (e, mailupConf, setMailupConf) => {\n  const newConf = { ...mailupConf }\n  const { name } = e.target\n  if (e.target.value !== '') {\n    newConf[name] = e.target.value\n  } else {\n    delete newConf[name]\n  }\n  setMailupConf({ ...newConf })\n}\n\nexport const fetchAllList = (mailupConf, setMailupConf, setIsLoading, setSnackbar) => {\n  setIsLoading(true)\n  const requestParams = {\n    tokenDetails: mailupConf.tokenDetails,\n    clientId: mailupConf.clientId,\n    clientSecret: mailupConf.clientSecret,\n  }\n  bitsFetch(requestParams, 'mailup_fetch_all_list')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...mailupConf }\n        if (result.data) {\n          newConf.allList = result.data\n        }\n        setSnackbar({ show: true, msg: __('Mailup all lists fetched successfully', 'bit-integrations') })\n        setMailupConf({ ...newConf })\n      } else {\n        setSnackbar({ show: true, msg: __('Mailup lists fetching failed. please try again', 'bit-integrations') })\n      }\n      setIsLoading(false)\n    })\n    .catch(() => setIsLoading(false))\n}\n\nexport const fetchAllGroup = (mailupConf, setMailupConf, setIsLoading, setSnackbar) => {\n  setIsLoading(true)\n  const requestParams = {\n    tokenDetails: mailupConf.tokenDetails,\n    clientId: mailupConf.clientId,\n    clientSecret: mailupConf.clientSecret,\n    listId: mailupConf.listId,\n  }\n  bitsFetch(requestParams, 'mailup_fetch_all_group')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...mailupConf }\n        if (result.data) {\n          newConf.allGroup = result.data\n        }\n        setSnackbar({ show: true, msg: __('All groups fetched successfully', 'bit-integrations') })\n        setMailupConf({ ...newConf })\n      } else {\n        setSnackbar({ show: true, msg: __('Groups fetching failed. please try again', 'bit-integrations') })\n      }\n      setIsLoading(false)\n    })\n    .catch(() => setIsLoading(false))\n}\n\nexport const setGrantTokenResponse = (integ) => {\n  const grantTokenResponse = {}\n  const authWindowLocation = window.location.href\n  const queryParams = authWindowLocation.replace(`${window.opener.location.href}`, '').split('&')\n  if (queryParams) {\n    queryParams.forEach(element => {\n      const gtKeyValue = element.split('=')\n      if (gtKeyValue[1]) {\n        // eslint-disable-next-line prefer-destructuring\n        grantTokenResponse[gtKeyValue[0]] = gtKeyValue[1]\n      }\n    })\n  }\n  localStorage.setItem(`__${integ}`, JSON.stringify(grantTokenResponse))\n  window.close()\n}\n\nexport const handleMailupAuthorize = (integ, confTmp, setConf, setError, setIsAuthorized, setIsLoading, setSnackbar) => {\n  if (!confTmp.clientId) {\n    setError({ clientId: !confTmp.clientId ? __('Client ID can\\'t be empty', 'bit-integrations') : '' })\n    return\n  }\n  if (!confTmp.clientSecret) {\n    setError({ clientSecret: !confTmp.clientSecret ? __('Client secret can\\'t be empty', 'bit-integrations') : '' })\n    return\n  }\n  setIsLoading(true)\n\n  const apiEndpoint = `https://services.mailup.com/Authorization/OAuth/LogOn?client_id=${confTmp.clientId}&response_type=code&redirect_uri=${encodeURIComponent(window.location.href)}`\n\n  const authWindow = window.open(apiEndpoint, integ, 'width=400,height=609,toolbar=off')\n  const popupURLCheckTimer = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(popupURLCheckTimer)\n      let grantTokenResponse = {}\n      let isauthRedirectLocation = false\n      const bitsMailup = localStorage.getItem(`__${integ}`)\n\n      if (bitsMailup) {\n        isauthRedirectLocation = true\n        grantTokenResponse = JSON.parse(bitsMailup)\n        localStorage.removeItem(`__${integ}`)\n\n        if (grantTokenResponse.token) {\n          grantTokenResponse.code = grantTokenResponse.token\n        }\n      }\n      if (!grantTokenResponse.code || grantTokenResponse.error || !grantTokenResponse || !isauthRedirectLocation) {\n        const errorCause = grantTokenResponse.error ? `Cause: ${grantTokenResponse.error}` : ''\n        setSnackbar({ show: true, msg: `${__('Authorization failed', 'bit-integrations')} ${errorCause}. ${__('please try again', 'bit-integrations')}` })\n        setIsLoading(false)\n      } else {\n        const newConf = { ...confTmp }\n        tokenHelper(grantTokenResponse, newConf, setConf, setIsAuthorized, setIsLoading)\n      }\n    }\n    setIsLoading(false)\n  }, 500)\n}\n\nconst tokenHelper = (grantToken, confTmp, setConf, setIsAuthorized, setIsLoading) => {\n  const tokenRequestParams = { ...grantToken }\n  tokenRequestParams.clientId = confTmp.clientId\n  tokenRequestParams.clientSecret = confTmp.clientSecret\n  // eslint-disable-next-line no-undef\n\n  bitsFetch(tokenRequestParams, 'mailup_authorization')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...confTmp }\n        newConf.tokenDetails = result.data\n        setConf(newConf)\n        setIsAuthorized(true)\n        toast.success(__('Authorized Successfully', 'bit-integrations'))\n      } else if ((result && result.data && result.data.data) || (!result.success && typeof result.data === 'string')) {\n        toast.error(`${__('Authorization failed Cause:', 'bit-integrations')}${result.data.data || result.data}. ${__('please try again', 'bit-integrations')}`)\n      } else {\n        toast.error(__('Authorization failed. please try again', 'bit-integrations'))\n      }\n      setIsLoading(false)\n    })\n}\n\nexport const generateMappedField = (mailupConf) => {\n  const requiredFlds = mailupConf?.staticFields.filter(fld => fld.required === true)\n  return requiredFlds.length > 0 ? requiredFlds.map(field => ({ formField: '', mailupFormField: field.key })) : [{ formField: '', mailupFormField: '' }]\n}\n\nexport const checkMappedFields = (mailupConf) => {\n  const mappedFields = mailupConf?.field_map ? mailupConf.field_map.filter(mappedField => (!mappedField.formField || !mappedField.mailupFormField || (!mappedField.formField === 'custom' && !mappedField.customValue))) : []\n  if (mappedFields.length > 0) {\n    return false\n  }\n  return true\n}\n"],"names":["__","bitsFetch","_t","handleInput","mailupConf","setMailupConf","newConf","__spreadValues","name","fetchAllList","setIsLoading","setSnackbar","requestParams","result","fetchAllGroup","setGrantTokenResponse","integ","grantTokenResponse","queryParams","element","gtKeyValue","handleMailupAuthorize","confTmp","setConf","setError","setIsAuthorized","apiEndpoint","authWindow","popupURLCheckTimer","isauthRedirectLocation","bitsMailup","errorCause","tokenHelper","grantToken","tokenRequestParams","toast","generateMappedField","requiredFlds","fld","field","checkMappedFields","mappedField"],"mappings":"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"}