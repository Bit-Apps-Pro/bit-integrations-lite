{"version":3,"file":"bi.92.854.js","sources":["../frontend-dev/src/components/AllIntegrations/ZohoSheet/ZohoSheetCommonFunc.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable no-else-return */\nimport toast from 'react-hot-toast'\nimport bitsFetch from '../../../Utils/bitsFetch'\nimport { __ } from '../../../Utils/i18nwrap'\n\nexport const handleInput = (e, zohoSheetConf, setZohoSheetConf) => {\n  const newConf = { ...zohoSheetConf }\n  const { name } = e.target\n  if (e.target.value !== '') {\n    newConf[name] = e.target.value\n  } else {\n    delete newConf[name]\n  }\n  setZohoSheetConf({ ...newConf })\n}\n\nexport const generateMappedField = (zohoSheetConf) => {\n  const requiredFlds = zohoSheetConf?.workSheetHeaders.filter(fld => fld.required === true)\n  return requiredFlds.length > 0 ? requiredFlds.map(field => ({ formField: '', zohoSheetFormField: field.key })) : [{ formField: '', zohoSheetFormField: '' }]\n}\n\nexport const checkMappedFields = (zohoSheetConf) => {\n  const mappedFields = zohoSheetConf?.field_map ? zohoSheetConf.field_map.filter(mappedField => (!mappedField.formField || !mappedField.zohoSheetFormField || (mappedField.formField === 'custom' && !mappedField.customValue))) : []\n  if (mappedFields.length > 0) {\n    return false\n  }\n  return true\n}\n\nexport const getAllWorkbooks = (confTmp, setConf, loading, setLoading) => {\n  setLoading({ ...loading, workbooks: true })\n  const requestParams = { tokenDetails: confTmp.tokenDetails, clientId: confTmp.clientId, clientSecret: confTmp.clientSecret, dataCenter: confTmp.dataCenter }\n\n  bitsFetch(requestParams, 'zohoSheet_fetch_all_work_books')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...confTmp }\n        if (result.data) {\n          newConf.workbooks = result.data\n        }\n        setConf(newConf)\n        setLoading({ ...loading, workbooks: false })\n        toast.success(__('Workbooks fetched successfully', 'bit-integrations'))\n        return\n      }\n      setLoading({ ...loading, workbooks: false })\n      toast.error(__('Workbooks fetching failed', 'bit-integrations'))\n    })\n}\n\nexport const getAllWorksheets = (confTmp, setConf, loading, setLoading) => {\n  setLoading({ ...loading, worksheets: true })\n  const requestParams = { tokenDetails: confTmp.tokenDetails, clientId: confTmp.clientId, clientSecret: confTmp.clientSecret, dataCenter: confTmp.dataCenter, workbook: confTmp.selectedWorkbook }\n\n  bitsFetch(requestParams, 'zohoSheet_fetch_all_work_sheets')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...confTmp }\n        if (result.data) {\n          newConf.worksheets = result.data\n        }\n        setConf(newConf)\n        setLoading({ ...loading, worksheets: false })\n        toast.success(__('Worksheets fetched successfully', 'bit-integrations'))\n        return\n      }\n      setLoading({ ...loading, worksheets: false })\n      toast.error(__('Worksheets fetching failed', 'bit-integrations'))\n    })\n}\n\nexport const getWorksheetHeader = (confTmp, setConf, loading, setLoading) => {\n  setLoading({ ...loading, header: true, workSheetHeaders: false })\n  const requestParams = {\n    tokenDetails: confTmp.tokenDetails,\n    clientId: confTmp.clientId,\n    clientSecret: confTmp.clientSecret,\n    dataCenter: confTmp.dataCenter,\n    workbook: confTmp.selectedWorkbook,\n    worksheet: confTmp.selectedWorksheet,\n    headerRow: confTmp.headerRow,\n  }\n\n  bitsFetch(requestParams, 'zohoSheet_fetch_all_work_sheet_header')\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...confTmp }\n        if (result.data) {\n          newConf.workSheetHeaders = result.data\n        }\n        setConf(newConf)\n        setLoading({ ...loading, header: false, workSheetHeaders: true })\n        toast.success(__('Worksheet headers fetched successfully', 'bit-integrations'))\n        return\n      }\n      setLoading({ ...loading, header: false, workSheetHeaders: false })\n      toast.error(__(`${result.data}`, 'bit-integrations'))\n    })\n}\n\nexport const setGrantTokenResponse = (integ) => {\n  const grantTokenResponse = {}\n  const authWindowLocation = window.location.href\n  const queryParams = authWindowLocation.replace(`${window.opener.location.href}/redirect`, '').split('&')\n  if (queryParams) {\n    queryParams.forEach(element => {\n      const gtKeyValue = element.split('=')\n      if (gtKeyValue[1]) {\n        // eslint-disable-next-line prefer-destructuring\n        grantTokenResponse[gtKeyValue[0]] = gtKeyValue[1]\n      }\n    })\n  }\n  localStorage.setItem(`__${integ}`, JSON.stringify(grantTokenResponse))\n  window.close()\n}\n\nexport const handleAuthorization = (confTmp, setConf, setError, setisAuthorized, loading, setLoading) => {\n  if (!confTmp.dataCenter || !confTmp.clientId || !confTmp.clientSecret) {\n    setError({\n      dataCenter: !confTmp.dataCenter ? __('Data center can\\'t be empty') : '',\n      clientId: !confTmp.clientId ? __('Client ID can\\'t be empty') : '',\n      clientSecret: !confTmp.clientSecret ? __('Secret key can\\'t be empty') : '',\n    })\n    return\n  }\n  setLoading({ ...loading, auth: true })\n  const scopes = 'ZohoSheet.dataAPI.READ,ZohoSheet.dataAPI.UPDATE'\n  const apiEndpoint = `https://accounts.zoho.${confTmp.dataCenter}/oauth/v2/auth?scope=${scopes}&response_type=code&client_id=${confTmp.clientId}&prompt=Consent&access_type=offline&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(`${btcbi.api.base}/redirect`)}`\n  const authWindow = window.open(apiEndpoint, '__zohoSheet', 'width=400,height=609,toolbar=off')\n  const popupURLCheckTimer = setInterval(() => {\n    if (authWindow.closed) {\n      clearInterval(popupURLCheckTimer)\n      let grantTokenResponse = {}\n      let isauthRedirectLocation = false\n      const ZohoSheet = localStorage.getItem('__zohoSheet')\n      if (ZohoSheet) {\n        isauthRedirectLocation = true\n        grantTokenResponse = JSON.parse(ZohoSheet)\n        localStorage.removeItem('__zohoSheet')\n      }\n      if (!grantTokenResponse.code || grantTokenResponse.error || !grantTokenResponse || !isauthRedirectLocation) {\n        const errorCause = grantTokenResponse.error ? `Cause: ${grantTokenResponse.error}` : ''\n        toast.error(__(`${__('Authorization failed')} ${errorCause}. ${__('please try again')}`, 'bit-integrations'))\n        setLoading({ ...loading, auth: false })\n      } else {\n        const newConf = { ...confTmp }\n        newConf.accountServer = grantTokenResponse['accounts-server']\n        tokenHelper(grantTokenResponse, newConf, setConf, setisAuthorized, loading, setLoading)\n      }\n    }\n  }, 500)\n}\n\nconst tokenHelper = (grantToken, confTmp, setConf, setisAuthorized, loading, setLoading) => {\n  const tokenRequestParams = { ...grantToken }\n  tokenRequestParams.dataCenter = confTmp.dataCenter\n  tokenRequestParams.clientId = confTmp.clientId\n  tokenRequestParams.clientSecret = confTmp.clientSecret\n  tokenRequestParams.redirectURI = `${btcbi.api.base}/redirect`\n  bitsFetch(tokenRequestParams, 'zohoSheet_generate_token')\n    .then(result => result)\n    .then(result => {\n      if (result && result.success) {\n        const newConf = { ...confTmp }\n        newConf.tokenDetails = result.data\n        setConf(newConf)\n        setisAuthorized(true)\n        toast.success(__('Authorized Successfully', 'bit-integrations'))\n        getAllWorkbooks(newConf, setConf, loading, setLoading)\n      } else if ((result && result.data && result.data.data) || (!result.success && typeof result.data === 'string')) {\n        toast.error(__(`${__('Authorization failed Cause:')}${result.data.data || result.data}. ${__('please try again')}`, 'bit-integrations'))\n      } else {\n        toast.error(__('Authorization failed. please try again', 'bit-integrations'))\n      }\n      setLoading({ ...loading, auth: false })\n    })\n}\n"],"names":["__","_t","bitsFetch","handleInput","zohoSheetConf","setZohoSheetConf","newConf","__spreadValues","name","checkMappedFields","mappedField","getAllWorkbooks","confTmp","setConf","loading","setLoading","__spreadProps","requestParams","result","toast","getAllWorksheets","getWorksheetHeader","setGrantTokenResponse","integ","grantTokenResponse","queryParams","element","gtKeyValue","handleAuthorization","setError","setisAuthorized","scopes","apiEndpoint","authWindow","popupURLCheckTimer","isauthRedirectLocation","ZohoSheet","errorCause","tokenHelper","grantToken","tokenRequestParams"],"mappings":"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"}