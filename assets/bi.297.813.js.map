{"version":3,"file":"bi.297.813.js","sources":["../frontend-dev/src/components/AllIntegrations/Moosend/MoosendCommonFunc.js"],"sourcesContent":["/* eslint-disable no-unused-expressions */\nimport toast from \"react-hot-toast\";\nimport bitsFetch from \"../../../Utils/bitsFetch\";\nimport { __ } from \"../../../Utils/i18nwrap\";\nimport {\n  saveActionConf,\n  saveIntegConfig,\n} from \"../IntegrationHelpers/IntegrationHelpers\";\n\nexport const handleInput = (e, conf, setConf, error, setError) => {\n  const newConf = { ...conf };\n  const inputError = { ...error };\n  inputError[e.target.name] = \"\";\n  newConf[e.target.name] = e.target.value;\n  setError(inputError);\n  setConf(newConf);\n};\n\nexport const handleAuthorize = (\n  conf,\n  setError,\n  setAuthorized,\n  loading,\n  setLoading\n) => {\n  if (!conf.authKey) {\n    setError({ authKey: !conf.authKey ? __(\"API key can't be empty\") : \"\" });\n    return;\n  }\n  setError({});\n  setLoading({ ...loading, auth: true });\n\n  const requestParams = { authKey: conf.authKey };\n\n  bitsFetch(requestParams, \"moosend_handle_authorize\").then((result) => {\n    if (result.data.Code === 0) {\n      setAuthorized(true);\n      setLoading({ ...loading, auth: false });\n      toast.success(__(\"Authorized successfully\"));\n      return;\n    }\n    setLoading({ ...loading, auth: false });\n    toast.error(__(\"Authorized failed\"));\n  });\n};\n\nexport const getAllLists = async (conf, setConf, loading, setLoading) => {\n  setLoading && setLoading({ ...loading, list: true });\n  const requestParams = { authKey: conf.authKey };\n  const result = await bitsFetch(requestParams, \"moosend_handle_authorize\");\n  if (result.success && result.data.Code === 0) {\n    const { MailingLists } = result.data.Context;\n    const newConf = { ...conf };\n    if (MailingLists) {\n      if (!newConf.default) {\n        newConf.default = {};\n      }\n      newConf.default.lists = MailingLists;\n      setConf(newConf);\n      if (setLoading) {\n        setLoading({ ...loading, list: false });\n        toast.success(__(\"List refresh successfully\"));\n      }\n    }\n    return true;\n  }\n  if (setLoading) {\n    setLoading({ ...loading, list: false });\n    toast.success(__(\"List refresh failed\"));\n  }\n  return false;\n};\n\nexport const generateMappedField = (moosendConf) => {\n  const requiredFlds = moosendConf?.moosendFields.filter(\n    (fld) => fld.required === true\n  );\n  return requiredFlds.length > 0\n    ? requiredFlds.map((field) => ({\n        formFields: \"\",\n        moosendFormFields: field.key,\n      }))\n    : [{ formFields: \"\", moosendFormFields: \"\" }];\n};\n\nexport const checkMappedFields = (moosendConf) => {\n  const mappedFields = moosendConf?.field_map\n    ? moosendConf.field_map.filter(\n        (mappedField) =>\n          !mappedField.formFields ||\n          !mappedField.moosendFormFields ||\n          (!mappedField.formFields === \"custom\" && !mappedField.customValue)\n      )\n    : [];\n  if (mappedFields.length > 0) {\n    return false;\n  }\n  return true;\n};\n\nexport const nextPage = (conf, setStep, pageNo) => {\n  setTimeout(() => {\n    document.getElementById(\"btcd-settings-wrp\").scrollTop = 0;\n  }, 300);\n\n  if (!conf.listId && conf.method !== \"0\") {\n    toast.error(\"Please select list\");\n  }\n  if (!checkMappedFields(conf)) {\n    toast.error(\"Please map mandatory fields\");\n    return;\n  }\n  conf.field_map.length > 0 && setStep(pageNo);\n};\n\nexport const saveConfig = (\n  flow,\n  setFlow,\n  allIntegURL,\n  conf,\n  navigate,\n  setLoading\n) => {\n  setLoading(true);\n  const resp = saveIntegConfig(\n    flow,\n    setFlow,\n    allIntegURL,\n    conf,\n    navigate,\n    \"\",\n    \"\",\n    setLoading\n  );\n  resp.then((res) => {\n    if (res.success) {\n      toast.success(res.data?.msg);\n      navigate(allIntegURL);\n    } else {\n      toast.error(res.data || res);\n    }\n  });\n};\n\nexport const saveUpdateConfig = (\n  flow,\n  allIntegURL,\n  conf,\n  navigate,\n  edit,\n  setIsLoading\n) => {\n  if (!checkMappedFields(conf)) {\n    toast.error(\"Please map mandatory fields\");\n    return;\n  }\n  saveActionConf({ flow, allIntegURL, conf, navigate, edit, setIsLoading });\n};\n"],"names":["__","bitsFetch","_t","saveIntegConfig","saveActionConf","handleInput","conf","setConf","error","setError","newConf","__spreadValues","inputError","handleAuthorize","setAuthorized","loading","setLoading","__spreadProps","requestParams","result","toast","getAllLists","__async","MailingLists","generateMappedField","moosendConf","requiredFlds","fld","field","checkMappedFields","mappedField","nextPage","setStep","pageNo","saveConfig","flow","setFlow","allIntegURL","navigate","res","_a","saveUpdateConfig","edit","setIsLoading"],"mappings":"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"}